<!DOCTYPE html>
<html>
<head>
    <title>Fracture - Game</title>
    <style>
        body { margin:0; overflow:hidden; background:#111; }
        canvas { display:block; }

        #ui {
            position: fixed;
            top: 10px;
            left: 10px;
            color: #0ff;
            font-family: Arial;
            font-size: 16px;
            text-shadow: 0 0 6px #0ff;
            z-index: 10;
        }

        #npcHpBar {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 200px;
            height: 20px;
            background: #222;
            border: 2px solid #f33;
            display: none;
        }

        #npcHpBarInner {
            height: 100%;
            width: 100%;
            background: #f33;
        }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="ui">
    <div id="hp">HP: 100</div>
    <div id="stamina">Stamina: 100</div>
    <div id="level">Level: 1</div>
    <div id="xp">XP: 0</div>
    <div id="strength">Strength: 10</div>
    <div id="speed">Speed: 4</div>
    <div id="defense">Defense: 0</div>
    <div id="energy">Energy: 100</div>
</div>

<div id="npcHpBar">
    <div id="npcHpBarInner"></div>
</div>

<script>
// ===== CANVAS =====
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// ===== PLAYER STATS =====
const player = {
    x: 0, y: 0,
    w: 40, h: 60,
    velX: 0, velY: 0,
    facing: 1,
    jumping: false,
    jumpCount:0,
    maxJumps:2,
    dashTime:0,
    dashCooldown:0,
    attackTime:0,
    attackCooldown:0,
    stamina: 100,
    energy: 100,
    hp: 100,
    maxHp: 100,
    level:1,
    xp:0,
    stats: {
        speed:4,
        strength:10,
        defense:0,
        energy:100
    }
};

// ===== NPC =====
const npc = {
    x:400,
    y:0,
    w:40,
    h:60,
    hp:100,
    maxHp:100,
    alive:true
};

// ===== INPUT =====
const keys = {};
document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

let mouseDown = false;
canvas.addEventListener("mousedown",()=>mouseDown=true);
canvas.addEventListener("mouseup",()=>mouseDown=false);

// ===== PARTICLES =====
const particles = [];
function spawnParticle(x,y,color){
    particles.push({
        x,y,
        size:Math.random()*4+2,
        velX:(Math.random()*4-2),
        velY:(Math.random()*-2),
        life:15,
        color
    });
}

// ===== CAMERA =====
let camX=0;

// ===== HELPERS =====
function rectCollide(a,b){
    return a.x<a.x+b.w && a.x+a.w>b.x && a.y<a.y+b.h && a.y+a.h>b.y;
}

function getNPCBox(){
    const ground = canvas.height - 80;
    return {x:npc.x, y:ground - npc.h, w:npc.w, h:npc.h};
}

function getAttackBox(){
    return {
        x: player.x + (player.facing===1 ? player.w : -player.stats.strength*5),
        y: player.y,
        w: player.stats.strength*5,
        h: player.h
    };
}

// ===== UPDATE =====
function update(){
    // GRAVITY
    player.velY += 0.8;

    // FACING
    if(keys["a"]) player.facing=-1;
    if(keys["d"]) player.facing=1;

    // SPRINT
    let moveSpeed = keys["shift"]&&player.stamina>0 ? player.stats.speed*1.7 : player.stats.speed;
    if(keys["shift"]&&player.stamina>0) player.stamina-=0.5;
    else player.stamina+=0.4;
    player.stamina=Math.max(0,Math.min(100,player.stamina));

    // MOVEMENT
    if(keys["a"]) player.velX=-moveSpeed;
    else if(keys["d"]) player.velX=moveSpeed;
    else player.velX*=0.8;

    // DOUBLE JUMP
    if(keys[" "]&&player.jumpCount<player.maxJumps){
        player.velY=-12;
        spawnParticle(player.x+20,player.y+player.h,"#0ff");
        player.jumpCount++;
        keys[" "]=false;
    }

    // DASH
    if(keys["q"]&&player.dashCooldown<=0){
        player.dashTime=10;
        player.dashCooldown=30;
        player.velX=player.facing*14;
        spawnParticle(player.x+player.w/2,player.y+player.h/2,"#3af");
        keys["q"]=false;
    }
    if(player.dashTime>0) player.dashTime--;
    if(player.dashCooldown>0) player.dashCooldown--;

    // ATTACK
    if(mouseDown && player.attackCooldown<=0){
        player.attackTime=10;
        player.attackCooldown=20;
        let hitbox=getAttackBox();
        let npcBox=getNPCBox();
        if(rectCollide(hitbox,npcBox) && npc.alive){
            npc.hp -= player.stats.strength;
            spawnParticle(npc.x+npc.w/2,npc.y+npc.h/2,"#f44");
            document.getElementById("npcHpBar").style.display="block";
        }
    }
    if(player.attackTime>0) player.attackTime--;
    if(player.attackCooldown>0) player.attackCooldown--;

    // POSITION
    player.x+=player.velX;
    player.y+=player.velY;

    // GROUND
    const ground=canvas.height-80;
    if(player.y+player.h>ground){
        player.y=ground-player.h;
        player.velY=0;
        player.jumpCount=0;
    }

    // PARTICLES
    for(let i=particles.length-1;i>=0;i--){
        let p=particles[i];
        p.x+=p.velX;
        p.y+=p.velY;
        p.life--;
        p.size*=0.92;
        if(p.life<=0) particles.splice(i,1);
    }

    // CAMERA
    camX += ((player.x-canvas.width/2)-camX)*0.08;

    // UPDATE UI
    document.getElementById("hp").innerText="HP: "+parseInt(player.hp);
    document.getElementById("stamina").innerText="Stamina: "+parseInt(player.stamina);
    document.getElementById("level").innerText="Level: "+player.level;
    document.getElementById("xp").innerText="XP: "+player.xp;
    document.getElementById("strength").innerText="Strength: "+player.stats.strength;
    document.getElementById("speed").innerText="Speed: "+player.stats.speed;
    document.getElementById("defense").innerText="Defense: "+player.stats.defense;
    document.getElementById("energy").innerText="Energy: "+player.stats.energy;

    // NPC DEAD CHECK
    if(npc.hp<=0) npc.alive=false;
    document.getElementById("npcHpBarInner").style.width = npc.hp>0? npc.hp+"%" : "0%";
}

// ===== DRAW =====
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.save();
    ctx.translate(-camX,0);

    // GROUND
    ctx.fillStyle="#222";
    ctx.fillRect(camX,canvas.height-80,canvas.width*2,80);

    // NPC
    if(npc.alive){
        let npcBox=getNPCBox();
        ctx.fillStyle="#f33";
        ctx.fillRect(npcBox.x,npcBox.y,npcBox.w,npcBox.h);
    }

    // PLAYER
    ctx.fillStyle="#4af";
    ctx.fillRect(player.x,player.y,player.w,player.h);

    // ATTACK HITBOX
    if(player.attackTime>0){
        let hitbox=getAttackBox();
        ctx.fillStyle="rgba(255,255,255,0.3)";
        ctx.fillRect(hitbox.x,hitbox.y,hitbox.w,hitbox.h);
    }

    // PARTICLES
    for(let p of particles){
        ctx.fillStyle=p.color;
        ctx.fillRect(p.x,p.y,p.size,p.size);
    }

    ctx.restore();
}

// ===== LOOP =====
function loop(){ update(); draw(); requestAnimationFrame(loop);}
loop();
</script>

</body>
</html>
